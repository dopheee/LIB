# ğŸš€ SCHED ä»»åŠ¡è°ƒåº¦æ¨¡å—

`sched.c` å’Œ `sched.h` æä¾›äº†ä¸€ä¸ª**è½»é‡çº§é«˜æ•ˆ**çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼Œæ”¯æŒå¤šä»»åŠ¡ç®¡ç†ã€å‘¨æœŸæ€§æ‰§è¡Œå’Œå‚æ•°åŒ–å›è°ƒï¼Œé€‚ç”¨äºåµŒå…¥å¼ç³»ç»Ÿã€MCUã€å•ç‰‡æœºç­‰èµ„æºå—é™åœºæ™¯ã€‚

---

## âœ¨ åŠŸèƒ½ç®€ä»‹

- ğŸ“‹ **å¤šä»»åŠ¡æ”¯æŒ**ï¼šæœ€å¤šæ”¯æŒ8ä¸ªç‹¬ç«‹ä»»åŠ¡
- ğŸ”„ **å‘¨æœŸè°ƒåº¦**ï¼šæ”¯æŒè®¾ç½®ä¸åŒä»»åŠ¡å‘¨æœŸï¼ˆmsï¼‰
- ğŸ¯ **å‚æ•°åŒ–å›è°ƒ**ï¼šæ”¯æŒå¸¦ç”¨æˆ·è‡ªå®šä¹‰å‚æ•°çš„å›è°ƒå‡½æ•°
- âš¡ **å³æ—¶ä»»åŠ¡**ï¼šæ”¯æŒå‘¨æœŸä¸º0çš„å³æ—¶ä»»åŠ¡æ‰§è¡Œ
- ğŸ› ï¸ **çµæ´»é…ç½®**ï¼šä»»åŠ¡å¯åŠ¨æ€æ³¨å†Œå’Œå¯ç”¨
- ğŸ” **é«˜æ•ˆè½®è¯¢**ï¼šä¼˜åŒ–çš„ä»»åŠ¡è½®è¯¢æœºåˆ¶ï¼Œç¡®ä¿åŠæ—¶å“åº”

---

## ğŸ“ ä½¿ç”¨æ–¹æ³•

1. **åˆå§‹åŒ–æ¨¡å—**ï¼šè°ƒç”¨ `sched_init` å‡½æ•°åˆå§‹åŒ–è°ƒåº¦ç³»ç»Ÿï¼Œä¼ å…¥è·å–ç³»ç»Ÿæ—¶é—´çš„å‡½æ•°
2. **æ³¨å†Œä»»åŠ¡**ï¼šè°ƒç”¨ `sched_register` å‡½æ•°æ³¨å†Œä»»åŠ¡ï¼Œä¼ å…¥ä»»åŠ¡å‘¨æœŸã€å›è°ƒå‡½æ•°å’Œå‚æ•°
3. **è½®è¯¢è°ƒåº¦**ï¼šåœ¨ä¸»å¾ªç¯ä¸­è°ƒç”¨ `sched_poll` å‡½æ•°è¿›è¡Œä»»åŠ¡è°ƒåº¦

---

## ğŸ“š API å‚è€ƒ

### ğŸ”§ å‡½æ•°

```c
// åˆå§‹åŒ–å®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ
void sched_init(sched_get_tick_t get_tick);

// æ³¨å†Œä¸€ä¸ªå®šæ—¶ä»»åŠ¡
int sched_register(SCHED_U32 interval, sched_callback_t cb, void *param);

// è½®è¯¢è°ƒåº¦ä»»åŠ¡ï¼Œéœ€åœ¨ä¸»å¾ªç¯ä¸­å‘¨æœŸè°ƒç”¨
void sched_poll(void);
```

### ğŸ“Š æ•°æ®ç±»å‹

```c
// å®šæ—¶ä»»åŠ¡å›è°ƒå‡½æ•°ç±»å‹ï¼ˆå¸¦å‚æ•°ï¼‰
typedef void (*sched_callback_t)(void *param);

// è·å–å½“å‰tickçš„å‡½æ•°æŒ‡é’ˆç±»å‹
typedef SCHED_U32 (*sched_get_tick_t)(void);

// å®šæ—¶ä»»åŠ¡ç»“æ„ä½“
typedef struct
{
    SCHED_U32 interval_ms;      /* ä»»åŠ¡å‘¨æœŸï¼ˆmsï¼‰ */
    SCHED_U32 last_tick;        /* ä¸Šæ¬¡è§¦å‘tick */
    sched_callback_t callback;  /* å›è°ƒå‡½æ•° */
    void *param;                /* å›è°ƒå‚æ•° */
    SCHED_U8 enabled;           /* ä½¿èƒ½æ ‡å¿— */
} sched_task_t;

// ç±»å‹é‡å®šä¹‰
#define SCHED_CHAR        char
#define SCHED_U8          unsigned char
#define SCHED_U16         unsigned short
#define SCHED_U32         unsigned int
#define SCHED_S8          signed char
#define SCHED_S16         signed short
#define SCHED_S32         signed int
#define SCHED_BOOL        SCHED_U8
#define SCHED_TRUE        1
#define SCHED_FALSE       0
```

---

## ğŸ’» ç¤ºä¾‹ä»£ç 

```c
// åˆå§‹åŒ–ç³»ç»Ÿtickå‡½æ•°
extern uint32_t GetSystemTick(void);

// ä»»åŠ¡1å›è°ƒå‡½æ•°
void Task1Callback(void *param)
{
    // å¤„ç†ä»»åŠ¡1
    printf("ä»»åŠ¡1æ‰§è¡Œï¼Œå‚æ•°: %s\n", (char*)param);
}

// ä»»åŠ¡2å›è°ƒå‡½æ•°
void Task2Callback(void *param)
{
    // å¤„ç†ä»»åŠ¡2
    int count = *(int*)param;
    printf("ä»»åŠ¡2æ‰§è¡Œï¼Œè®¡æ•°: %d\n", count);
    (*(int*)param)++;
}

int main(void)
{
    // åˆå§‹åŒ–è°ƒåº¦ç³»ç»Ÿ
    sched_init(GetSystemTick);

    // æ³¨å†Œä»»åŠ¡1ï¼Œå‘¨æœŸ1000ms
    sched_register(1000, Task1Callback, "Task1 Param");

    // æ³¨å†Œä»»åŠ¡2ï¼Œå‘¨æœŸ500ms
    int task2_count = 0;
    sched_register(500, Task2Callback, &task2_count);

    // ä¸»å¾ªç¯
    while(1)
    {
        // è½®è¯¢è°ƒåº¦ä»»åŠ¡
        sched_poll();
    }
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. ä»»åŠ¡å›è°ƒå‡½æ•°åº”ä¿æŒç®€çŸ­ï¼Œé¿å…é•¿æ—¶é—´é˜»å¡
2. ç³»ç»Ÿtickå‡½æ•°éœ€æä¾›å‡†ç¡®çš„æ—¶é—´åŸºå‡†
3. ä»»åŠ¡æ•°é‡ä¸åº”è¶…è¿‡æœ€å¤§é™åˆ¶ï¼ˆ8ä¸ªï¼‰
4. å‘¨æœŸä¸º0çš„ä»»åŠ¡å°†åœ¨æ²¡æœ‰å…¶ä»–ä»»åŠ¡éœ€è¦æ‰§è¡Œæ—¶è¿è¡Œ
5. å›è°ƒå‡½æ•°ä¸­è®¿é—®å…±äº«èµ„æºæ—¶éœ€æ³¨æ„çº¿ç¨‹å®‰å…¨